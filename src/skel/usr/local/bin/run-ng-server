#!/bin/sh

echo "checking for running nailgun server"
ng ng-version

[ $? -eq 0 ] && echo "looks like nailgun server is running" && exit 1

NG_CLASSPATH="/usr/local/lib/*.jar /usr/local/lib/ScalaChimeraNailgun /usr/share/dcache/classes/*"
    
java -Dlog=warn -Dcom.sun.management.jmxremote.port=7778 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005 -jar /usr/local/lib/nailgun-server-0.9.2-SNAPSHOT.jar &

sleep 3

echo "setting classpath"
ng ng-cp $NG_CLASSPATH

if [ $? -ne 0 ]; then
    echo "failed to start nailgun server"
    exit 2
fi

echo "server up and running"

sleep 3

loadChimeraNailgun.sh

if [ $? -ne 0 ]; then
    echo "failed to set the nailgun aliases. "
    echo "Try running loadChimeraNailgun.sh manually"
    exit 3
fi

exit 0

